<ion-header>
  <ion-toolbar>
    <ion-title>{{ "settings.title" | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="settings-content">
    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{
          "settings.appearance.title" | translate
        }}</ion-card-title>
        <ion-card-subtitle>{{
          "settings.appearance.subtitle" | translate
        }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item lines="none" class="theme-item">
            <ion-label>
              <h3>{{ "settings.appearance.theme" | translate }}</h3>
              <p>{{ "settings.appearance.description" | translate }}</p>
            </ion-label>
            <ion-select
              [value]="facade.themePreference()"
              (ionChange)="facade.updateThemePreference($event.detail.value)"
              [disabled]="facade.isUpdatingTheme()"
              interface="popover"
              class="theme-select"
            >
              <ion-select-option value="light">{{
                "settings.appearance.light" | translate
              }}</ion-select-option>
              <ion-select-option value="dark">{{
                "settings.appearance.dark" | translate
              }}</ion-select-option>
              <ion-select-option value="system">{{
                "settings.appearance.system" | translate
              }}</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ "settings.ai.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{ "settings.ai.subtitle" | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item
            lines="none"
            button
            detail="true"
            routerLink="/settings/ai"
          >
            <ion-label>
              <h3>{{ "settings.ai.contextTitle" | translate }}</h3>
              <p>{{ "settings.ai.contextDescription" | translate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-card class="settings-card">
      <input
        type="file"
        accept="application/json,.json,*/*"
        hidden
        #importInput
        (change)="facade.submitImportFileSelection($event)"
      />
      <ion-card-header>
        <ion-card-title>{{ "settings.data.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{
          "settings.data.subtitle" | translate
        }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.data.resetTitle" | translate }}</h3>
              <p>{{ "settings.data.resetDescription" | translate }}</p>
            </ion-label>
            <ion-button
              color="danger"
              fill="clear"
              slot="end"
              (click)="facade.resetApplicationData()"
              [disabled]="facade.isResettingData()"
              [attr.aria-label]="'settings.data.resetAction' | translate"
            >
              @if (facade.isResettingData()) {
                <ion-spinner
                  slot="icon-only"
                  name="dots"
                ></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.data.exportTitle" | translate }}</h3>
              <p>{{ "settings.data.exportDescription" | translate }}</p>
            </ion-label>
            <ion-button
              slot="end"
              fill="clear"
              (click)="facade.exportDataBackup()"
              [disabled]="facade.isExportingData()"
              [attr.aria-label]="'settings.data.exportAction' | translate"
            >
              @if (facade.isExportingData()) {
                <ion-spinner
                  slot="icon-only"
                  name="dots"
                ></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="exit-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.data.importTitle" | translate }}</h3>
              <p>{{ "settings.data.importDescription" | translate }}</p>
            </ion-label>
            <ion-button
              slot="end"
              color="secondary"
              fill="clear"
              (click)="facade.openImportPicker(importInput)"
              [disabled]="facade.isImportingData()"
              [attr.aria-label]="'settings.data.importAction' | translate"
            >
              @if (facade.isImportingData()) {
                <ion-spinner
                  slot="icon-only"
                  name="dots"
                ></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="enter-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ "settings.catalogs.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{ "settings.catalogs.subtitle" | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item
            lines="none"
            button
            detail="true"
            routerLink="/settings/catalogos"
          >
            <ion-label>
              <h3>{{ "settings.catalogs.manageTitle" | translate }}</h3>
              <p>{{ "settings.catalogs.manageSubtitle" | translate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    @if (isDev) {
    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ "settings.dev.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{ "settings.dev.subtitle" | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item
            lines="none"
            button
            detail="true"
            routerLink="/onboarding"
          >
            <ion-label>
              <h3>{{ "settings.tutorial.title" | translate }}</h3>
              <p>{{ "settings.tutorial.subtitle" | translate }}</p>
            </ion-label>
          </ion-item>
          <ion-item
            lines="none"
            button
            detail="true"
            routerLink="/setup"
          >
            <ion-label>
              <h3>{{ "settings.dev.setupTitle" | translate }}</h3>
              <p>{{ "settings.dev.setupSubtitle" | translate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
    }

    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ "settings.info.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{
          "settings.info.subtitle" | translate
        }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.info.feedbackTitle" | translate }}</h3>
              <p>{{ "settings.info.feedbackSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              slot="end"
              fill="clear"
              color="primary"
              [attr.aria-label]="'settings.info.feedbackAction' | translate"
              href="mailto:fer.olmo92@gmail.com?subject=Feedback%20PantryMind"
            >
              <ion-icon name="paper-plane-outline"></ion-icon>
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.info.version" | translate }}</h3>
              <p>{{ appVersion }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
