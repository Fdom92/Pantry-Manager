<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ "settings.title" | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="settings-content">
    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{
          "settings.appearance.title" | translate
        }}</ion-card-title>
        <ion-card-subtitle>{{
          "settings.appearance.subtitle" | translate
        }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item lines="none" class="theme-item">
            <ion-label>
              <h3>{{ "settings.appearance.theme" | translate }}</h3>
              <p>{{ "settings.appearance.description" | translate }}</p>
            </ion-label>
          </ion-item>
          <div class="theme-grid" aria-label="{{ 'settings.appearance.theme' | translate }}">
            <button
              type="button"
              class="theme-option"
              [class.selected]="facade.themePreference() === 'light'"
              [attr.aria-pressed]="facade.themePreference() === 'light'"
              [disabled]="facade.isUpdatingTheme()"
              (click)="facade.updateThemePreference('light')"
            >
              <ion-icon name="sunny-outline"></ion-icon>
              <span>{{ "settings.appearance.light" | translate }}</span>
            </button>
            <button
              type="button"
              class="theme-option"
              [class.selected]="facade.themePreference() === 'dark'"
              [attr.aria-pressed]="facade.themePreference() === 'dark'"
              [disabled]="facade.isUpdatingTheme()"
              (click)="facade.updateThemePreference('dark')"
            >
              <ion-icon name="moon-outline"></ion-icon>
              <span>{{ "settings.appearance.dark" | translate }}</span>
            </button>
            <button
              type="button"
              class="theme-option"
              [class.selected]="facade.themePreference() === 'system'"
              [attr.aria-pressed]="facade.themePreference() === 'system'"
              [disabled]="facade.isUpdatingTheme()"
              (click)="facade.updateThemePreference('system')"
            >
              <ion-icon name="desktop-outline"></ion-icon>
              <span>{{ "settings.appearance.system" | translate }}</span>
            </button>
          </div>
        </ion-list>
      </ion-card-content>
    </ion-card>
    @if (isPro) {
      <ion-card class="settings-card">
        <ion-card-header>
          <ion-card-title>{{ "settings.ai.title" | translate }}</ion-card-title>
          <ion-card-subtitle>{{ "settings.ai.subtitle" | translate }}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <ion-list lines="none">
            <ion-item
              lines="none"
              button
              detail="true"
              routerLink="/settings/ai"
            >
              <ion-label>
                <h3>{{ "settings.ai.contextTitle" | translate }}</h3>
                <p>{{ "settings.ai.contextDescription" | translate }}</p>
              </ion-label>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    }

    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ "settings.notifications.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{ "settings.notifications.subtitle" | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item
            lines="none"
            button
            detail="true"
            routerLink="/settings/notificaciones"
          >
            <ion-label>
              <h3>{{ "settings.notifications.openTitle" | translate }}</h3>
              <p>{{ "settings.notifications.openSubtitle" | translate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ "settings.advanced.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{ "settings.advanced.subtitle" | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item
            lines="none"
            button
            detail="true"
            routerLink="/settings/avanzado"
          >
            <ion-label>
              <h3>{{ "settings.advanced.openTitle" | translate }}</h3>
              <p>{{ "settings.advanced.openSubtitle" | translate }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    @if (isDev) {
    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ "settings.dev.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{ "settings.dev.subtitle" | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">

          <!-- ── Onboarding ─────────────────────────────────── -->
          <ion-list-header>
            <ion-label>{{ "settings.dev.groupOnboarding" | translate }}</ion-label>
          </ion-list-header>

          <ion-item lines="none" button detail="true" routerLink="/onboarding">
            <ion-label>
              <h3>{{ "settings.tutorial.title" | translate }}</h3>
              <p>{{ "settings.tutorial.subtitle" | translate }}</p>
            </ion-label>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.resetOnboardingTitle" | translate }}</h3>
              <p>{{ "settings.dev.resetOnboardingSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              (click)="resetOnboarding()"
              [disabled]="isResettingOnboarding()"
              [attr.aria-label]="'settings.dev.resetOnboardingTitle' | translate"
            >
              @if (isResettingOnboarding()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <!-- ── Notifications ──────────────────────────────── -->
          <ion-list-header>
            <ion-label>{{ "settings.dev.groupNotifications" | translate }}</ion-label>
          </ion-list-header>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.testNotificationTitle" | translate }}</h3>
              <p>{{ "settings.dev.testNotificationSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              (click)="testNotification()"
              [disabled]="isTestingNotification()"
              [attr.aria-label]="'settings.dev.testNotificationAction' | translate"
            >
              @if (isTestingNotification()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="notifications-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.scheduleAtTimeTitle" | translate }}</h3>
              <p>{{ "settings.dev.scheduleAtTimeSubtitle" | translate }}</p>
            </ion-label>
            <input
              type="time"
              [value]="scheduleAtTimeInput()"
              (change)="onScheduleAtTimeChange($event)"
              style="margin-inline-end: 8px;"
            />
            <ion-button
              fill="clear"
              slot="end"
              (click)="scheduleAtTime()"
              [disabled]="isSchedulingAtTime()"
              [attr.aria-label]="'settings.dev.scheduleAtTimeAction' | translate"
            >
              @if (isSchedulingAtTime()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="time-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.previewNotificationTitle" | translate }}</h3>
              <p>{{ "settings.dev.previewNotificationSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              (click)="previewNotification()"
              [disabled]="isPreviewingNotification()"
              [attr.aria-label]="'settings.dev.previewNotificationTitle' | translate"
            >
              @if (isPreviewingNotification()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="eye-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.cancelNotificationsTitle" | translate }}</h3>
              <p>{{ "settings.dev.cancelNotificationsSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              color="danger"
              (click)="cancelAllNotifications()"
              [disabled]="isCancellingNotifications()"
              [attr.aria-label]="'settings.dev.cancelNotificationsTitle' | translate"
            >
              @if (isCancellingNotifications()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="close-circle-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <!-- ── Data ───────────────────────────────────────── -->
          <ion-list-header>
            <ion-label>{{ "settings.dev.groupData" | translate }}</ion-label>
          </ion-list-header>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.seedExpiredTitle" | translate }}</h3>
              <p>{{ "settings.dev.seedExpiredSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              (click)="seedExpiredItems()"
              [disabled]="isSeedingExpired()"
              [attr.aria-label]="'settings.dev.seedExpiredTitle' | translate"
            >
              @if (isSeedingExpired()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="skull-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.seedNearExpiryTitle" | translate }}</h3>
              <p>{{ "settings.dev.seedNearExpirySubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              (click)="seedNearExpiryItems()"
              [disabled]="isSeedingNearExpiry()"
              [attr.aria-label]="'settings.dev.seedNearExpiryTitle' | translate"
            >
              @if (isSeedingNearExpiry()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="warning-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.seedLowStockTitle" | translate }}</h3>
              <p>{{ "settings.dev.seedLowStockSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              (click)="seedLowStockItems()"
              [disabled]="isSeedingLowStock()"
              [attr.aria-label]="'settings.dev.seedLowStockTitle' | translate"
            >
              @if (isSeedingLowStock()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="cart-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.clearPantryTitle" | translate }}</h3>
              <p>{{ "settings.dev.clearPantrySubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              color="danger"
              (click)="clearPantry()"
              [disabled]="isClearingPantry()"
              [attr.aria-label]="'settings.dev.clearPantryTitle' | translate"
            >
              @if (isClearingPantry()) {
                <ion-spinner slot="icon-only" name="dots"></ion-spinner>
              } @else {
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              }
            </ion-button>
          </ion-item>

          <!-- ── App State ───────────────────────────────────── -->
          <ion-list-header>
            <ion-label>{{ "settings.dev.groupState" | translate }}</ion-label>
          </ion-list-header>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.toggleProTitle" | translate }}</h3>
              <p>{{ "settings.dev.toggleProSubtitle" | translate: { status: devIsPro() ? 'ON' : 'OFF' } }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              [color]="devIsPro() ? 'warning' : 'medium'"
              (click)="togglePro()"
              [attr.aria-label]="'settings.dev.toggleProTitle' | translate"
            >
              <ion-icon slot="icon-only" [name]="devIsPro() ? 'star' : 'star-outline'"></ion-icon>
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.dev.showAppStateTitle" | translate }}</h3>
              <p>{{ "settings.dev.showAppStateSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              fill="clear"
              slot="end"
              (click)="showAppState()"
              [attr.aria-label]="'settings.dev.showAppStateTitle' | translate"
            >
              <ion-icon slot="icon-only" name="information-circle-outline"></ion-icon>
            </ion-button>
          </ion-item>

        </ion-list>
      </ion-card-content>
    </ion-card>
    }

    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ "settings.info.title" | translate }}</ion-card-title>
        <ion-card-subtitle>{{
          "settings.info.subtitle" | translate
        }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.info.feedbackTitle" | translate }}</h3>
              <p>{{ "settings.info.feedbackSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              slot="end"
              fill="clear"
              color="primary"
              [attr.aria-label]="'settings.info.feedbackAction' | translate"
              href="mailto:fer.olmo92@gmail.com?subject=Feedback%20PantryMind"
            >
              <ion-icon name="paper-plane-outline"></ion-icon>
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.info.rateTitle" | translate }}</h3>
              <p>{{ "settings.info.rateSubtitle" | translate }}</p>
            </ion-label>
            <ion-button
              slot="end"
              fill="clear"
              color="primary"
              [attr.aria-label]="'settings.info.rateAction' | translate"
              href="https://play.google.com/store/apps/details?id=com.fdom.pantrymind"
              target="_blank"
            >
              <ion-icon name="star-outline"></ion-icon>
            </ion-button>
          </ion-item>

          <ion-item lines="none">
            <ion-label>
              <h3>{{ "settings.info.version" | translate }}</h3>
              <p>{{ appVersion }}</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
