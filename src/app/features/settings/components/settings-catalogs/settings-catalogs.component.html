  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-back-button defaultHref="/settings"></ion-back-button>
      </ion-buttons>
      <ion-title>{{ 'settings.catalogs.title' | translate }}</ion-title>
    </ion-toolbar>
  </ion-header>

<ion-content class="ion-padding">
  @if (state.isLoading()) {
    <ion-progress-bar type="indeterminate"></ion-progress-bar>
  }
  <div class="catalogs-content">
    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ 'settings.catalogs.locations.title' | translate }}</ion-card-title>
        <ion-card-subtitle>{{ 'settings.catalogs.locations.subtitle' | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="full">
          @if (!state.locationOptionsDraft().length) {
            <ion-item lines="none">
              <app-empty-state
                class="list-empty-state"
                icon="navigate-outline"
                [title]="'settings.catalogs.locations.title' | translate"
                [subtitle]="'settings.catalogs.locations.empty' | translate"
                [compact]="true">
              </app-empty-state>
            </ion-item>
          }

          @for (location of state.locationOptionsDraft(); track $index; let i = $index) {
            <ion-item>
              <ion-label>
                <h3>{{ 'settings.catalogs.locations.field' | translate:{ index: i + 1 } }}</h3>
                <p>{{ location }}</p>
              </ion-label>
              <ion-button
                slot="end"
                fill="clear"
                color="primary"
                [disabled]="state.locationOptionsDraft().length <= 0"
                (click)="state.removeLocationOption(i)">
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              </ion-button>
            </ion-item>
          }

          <div class="options-footer">
            <ion-button
              fill="clear"
              size="small"
              (click)="state.addLocationOption()">
              <ion-icon slot="start" name="add-circle-outline"></ion-icon>
              {{ 'settings.catalogs.locations.add' | translate }}
            </ion-button>
          </div>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ 'settings.catalogs.categories.title' | translate }}</ion-card-title>
        <ion-card-subtitle>{{ 'settings.catalogs.categories.subtitle' | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="full">
          @if (!state.categoryOptionsDraft().length) {
            <ion-item lines="none">
              <app-empty-state
                class="list-empty-state"
                icon="pricetag-outline"
                [title]="'settings.catalogs.categories.title' | translate"
                [subtitle]="'settings.catalogs.categories.empty' | translate"
                [compact]="true">
              </app-empty-state>
            </ion-item>
          }

          @for (category of state.categoryOptionsDraft(); track $index; let i = $index) {
            <ion-item>
              <ion-label>
                <h3>{{ 'settings.catalogs.categories.field' | translate:{ index: i + 1 } }}</h3>
                <p>{{ category }}</p>
              </ion-label>
              <ion-button
                slot="end"
                fill="clear"
                color="primary"
                (click)="state.removeCategoryOption(i)">
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              </ion-button>
            </ion-item>
          }

          <div class="options-footer">
            <ion-button
              fill="clear"
              size="small"
              (click)="state.addCategoryOption()">
              <ion-icon slot="start" name="add-circle-outline"></ion-icon>
              {{ 'settings.catalogs.categories.add' | translate }}
            </ion-button>
          </div>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <ion-card class="settings-card">
      <ion-card-header>
        <ion-card-title>{{ 'settings.catalogs.supermarkets.title' | translate }}</ion-card-title>
        <ion-card-subtitle>{{ 'settings.catalogs.supermarkets.subtitle' | translate }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="full">
          @if (!state.supermarketOptionsDraft().length) {
            <ion-item lines="none">
              <app-empty-state
                class="list-empty-state"
                icon="storefront-outline"
                [title]="'settings.catalogs.supermarkets.title' | translate"
                [subtitle]="'settings.catalogs.supermarkets.empty' | translate"
                [compact]="true">
              </app-empty-state>
            </ion-item>
          }

          @for (supermarket of state.supermarketOptionsDraft(); track $index; let i = $index) {
            <ion-item>
              <ion-label>
                <h3>{{ 'settings.catalogs.supermarkets.field' | translate:{ index: i + 1 } }}</h3>
                <p>{{ supermarket }}</p>
              </ion-label>
              <ion-button
                slot="end"
                fill="clear"
                color="primary"
                (click)="state.removeSupermarketOption(i)">
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              </ion-button>
            </ion-item>
          }

          <div class="options-footer">
            <ion-button
              fill="clear"
              size="small"
              (click)="state.addSupermarketOption()">
              <ion-icon slot="start" name="add-circle-outline"></ion-icon>
              {{ 'settings.catalogs.supermarkets.add' | translate }}
            </ion-button>
          </div>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <div class="catalog-actions">
      <ion-button
        expand="block"
        color="primary"
        (click)="state.submitCatalogs()"
        [disabled]="!state.hasAnyChanges() || state.isSaving() || state.hasDuplicateOptions()">
        @if (state.isSaving()) {
          <ion-spinner
            slot="start"
            name="dots">
          </ion-spinner>
        }
        {{ 'settings.catalogs.saveAction' | translate }}
      </ion-button>
    </div>
  </div>

  <ion-alert
    [isOpen]="state.isAddPromptOpen()"
    [header]="state.getAddPromptHeaderKey() | translate"
    [inputs]="state.getAddPromptInputs()"
    [buttons]="state.getAddPromptButtons()"
    (didDismiss)="state.onAddPromptDismiss()">
  </ion-alert>

  <ion-alert
    [isOpen]="state.isRemovalPromptOpen()"
    [header]="state.getRemovalPromptHeaderKey() | translate"
    [message]="state.getRemovalPromptMessage()"
    [buttons]="state.getRemovalPromptButtons()"
    (didDismiss)="state.onRemovalPromptDismiss()">
  </ion-alert>
</ion-content>
