<ion-header>
  <ion-toolbar>
    <ion-title>{{ 'dashboard.title' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="overview" [attr.aria-label]="'dashboard.overview.aria' | translate">
    @if (facade.visibleInsights().length) {
      <section class="overview-section">
        <header class="overview-section-header">
          <h2 class="overview-section-title">{{ 'dashboard.overview.sections.insights.title' | translate }}</h2>
        </header>
        <div class="insights-stack">
          @for (insight of facade.visibleInsights(); track insight.id) {
            <app-insight-card
              [insight]="insight"
              (dismiss)="facade.dismissInsight(insight)"
              (ctaSelect)="facade.onInsightAction(insight, $event)">
            </app-insight-card>
          }
        </div>
      </section>
    }

    @if (facade.isInventoryLoading() || facade.expiredItems().length || facade.nearExpiryItems().length) {
      <section class="overview-section">
        <header class="overview-section-header">
          <h2 class="overview-section-title">{{ 'dashboard.overview.sections.alerts.title' | translate }}</h2>
        </header>
        <div class="overview-grid" [attr.aria-label]="'dashboard.overview.sections.alerts.title' | translate">
          @if (facade.isInventoryLoading()) {
            <ion-card class="overview-card overview-card--expired">
              <ion-card-header>
                <div class="overview-card__header">
                  <div class="overview-card__icon">
                    <ion-icon name="alert-circle-outline"></ion-icon>
                  </div>
                  <ion-card-title>{{ 'dashboard.overview.cards.expired.title' | translate }}</ion-card-title>
                </div>
              </ion-card-header>
              <ion-card-content>
                <ion-skeleton-text animated style="width: 70%; height: 14px; margin-bottom: 8px;"></ion-skeleton-text>
                <ion-skeleton-text animated style="width: 40%; height: 12px;"></ion-skeleton-text>
              </ion-card-content>
            </ion-card>
            <ion-card class="overview-card overview-card--near-expiry">
              <ion-card-header>
                <div class="overview-card__header">
                  <div class="overview-card__icon">
                    <ion-icon name="hourglass-outline"></ion-icon>
                  </div>
                  <ion-card-title>{{ 'dashboard.overview.cards.nearExpiry.title' | translate }}</ion-card-title>
                </div>
              </ion-card-header>
              <ion-card-content>
                <ion-skeleton-text animated style="width: 70%; height: 14px; margin-bottom: 8px;"></ion-skeleton-text>
                <ion-skeleton-text animated style="width: 40%; height: 12px;"></ion-skeleton-text>
              </ion-card-content>
            </ion-card>
          } @else if (facade.expiredItems().length) {
            <ion-card
              class="overview-card overview-card--expired"
              role="button"
              tabindex="0"
              (click)="onSummaryCardClick('expired')"
              (keydown.enter)="onSummaryCardClick('expired')"
              (keydown.space)="onSummaryCardClick('expired'); $event.preventDefault()"
              [attr.aria-label]="'dashboard.overview.cards.expired.title' | translate"
            >
              <ion-card-header>
                <div class="overview-card__header">
                  <div class="overview-card__icon">
                    <ion-icon name="alert-circle-outline"></ion-icon>
                  </div>
                  <ion-card-title>{{ 'dashboard.overview.cards.expired.title' | translate }}</ion-card-title>
                </div>
              </ion-card-header>
              <ion-card-content>
                <p class="overview-card__body">
                  {{ 'dashboard.overview.cards.expired.body' | translate:{ count: facade.expiredItems().length } }}
                </p>
            <ion-button
              size="small"
              fill="clear"
              (click)="onSummaryCardClick('expired'); $event.stopPropagation()">
              {{ 'dashboard.overview.cards.expired.action' | translate }}
            </ion-button>
              </ion-card-content>
            </ion-card>
          }
          @if (!facade.isInventoryLoading() && facade.nearExpiryItems().length) {
            <ion-card
              class="overview-card overview-card--near-expiry"
              role="button"
              tabindex="0"
              (click)="onSummaryCardClick('near-expiry')"
              (keydown.enter)="onSummaryCardClick('near-expiry')"
              (keydown.space)="onSummaryCardClick('near-expiry'); $event.preventDefault()"
              [attr.aria-label]="'dashboard.overview.cards.nearExpiry.title' | translate"
            >
              <ion-card-header>
                <div class="overview-card__header">
                  <div class="overview-card__icon">
                    <ion-icon name="hourglass-outline"></ion-icon>
                  </div>
                  <ion-card-title>{{ 'dashboard.overview.cards.nearExpiry.title' | translate }}</ion-card-title>
                </div>
              </ion-card-header>
              <ion-card-content>
                <p class="overview-card__body">
                  {{ 'dashboard.overview.cards.nearExpiry.body' | translate:{ count: facade.nearExpiryItems().length } }}
                </p>
            <ion-button
              size="small"
              fill="clear"
              (click)="onSummaryCardClick('near-expiry'); $event.stopPropagation()">
              {{ 'dashboard.overview.cards.nearExpiry.action' | translate }}
            </ion-button>
              </ion-card-content>
            </ion-card>
          }
        </div>
      </section>
    }

    <section class="overview-section">
      <header class="overview-section-header">
        <h2 class="overview-section-title">{{ 'dashboard.overview.sections.dailyActions.title' | translate }}</h2>
      </header>
      <div class="overview-grid" [attr.aria-label]="'dashboard.overview.sections.dailyActions.title' | translate">
        <ion-card
          class="overview-card overview-card--consume"
          role="button"
          tabindex="0"
          (click)="facade.openConsumeTodayModal()"
          (keydown.enter)="facade.openConsumeTodayModal()"
          (keydown.space)="facade.openConsumeTodayModal(); $event.preventDefault()"
          [attr.aria-label]="'dashboard.overview.cards.consumeToday.title' | translate"
        >
          <ion-card-header>
            <div class="overview-card__header">
              <div class="overview-card__icon">
                <ion-icon name="restaurant-outline"></ion-icon>
              </div>
              <ion-card-title>{{ 'dashboard.overview.cards.consumeToday.title' | translate }}</ion-card-title>
            </div>
          </ion-card-header>
          <ion-card-content>
            <p class="overview-card__body">
              {{ 'dashboard.overview.cards.consumeToday.body' | translate }}
            </p>
            <ion-button
              size="small"
              fill="clear"
              (click)="facade.openConsumeTodayModal(); $event.stopPropagation()">
              {{ 'dashboard.overview.cards.consumeToday.action' | translate }}
            </ion-button>
          </ion-card-content>
        </ion-card>

        <ion-card
          class="overview-card overview-card--pending"
          role="button"
          tabindex="0"
          (click)="onSummaryCardClick('pending-review')"
          (keydown.enter)="onSummaryCardClick('pending-review')"
          (keydown.space)="onSummaryCardClick('pending-review'); $event.preventDefault()"
          [attr.aria-label]="'dashboard.overview.cards.pendingReview.title' | translate"
        >
          <ion-card-header>
            <div class="overview-card__header">
              <div class="overview-card__icon">
                <ion-icon name="clipboard-outline"></ion-icon>
              </div>
              <ion-card-title>{{ 'dashboard.overview.cards.pendingReview.title' | translate }}</ion-card-title>
            </div>
          </ion-card-header>
          <ion-card-content>
            <p class="overview-card__body">
              {{ 'dashboard.overview.cards.pendingReview.body' | translate:{ count: facade.pendingReviewProducts().length } }}
            </p>
            <ion-button
              size="small"
              fill="clear"
              (click)="onSummaryCardClick('pending-review'); $event.stopPropagation()">
              {{ 'dashboard.overview.cards.pendingReview.action' | translate }}
            </ion-button>
          </ion-card-content>
        </ion-card>
      </div>
    </section>

    @if (facade.isInventoryLoading() || facade.lowStockItems().length || facade.shoppingListCount()) {
      <section class="overview-section">
        <header class="overview-section-header">
          <h2 class="overview-section-title">{{ 'dashboard.overview.sections.control.title' | translate }}</h2>
        </header>
        <div class="overview-grid" [attr.aria-label]="'dashboard.overview.sections.control.title' | translate">
          @if (facade.isInventoryLoading()) {
            <ion-card class="overview-card overview-card--stock">
              <ion-card-header>
                <div class="overview-card__header">
                  <div class="overview-card__icon">
                    <ion-icon name="trending-down-outline"></ion-icon>
                  </div>
                  <ion-card-title>{{ 'dashboard.overview.cards.lowOrEmpty.title' | translate }}</ion-card-title>
                </div>
              </ion-card-header>
              <ion-card-content>
                <ion-skeleton-text animated style="width: 70%; height: 14px; margin-bottom: 8px;"></ion-skeleton-text>
                <ion-skeleton-text animated style="width: 40%; height: 12px;"></ion-skeleton-text>
              </ion-card-content>
            </ion-card>
            <ion-card class="overview-card overview-card--shopping">
              <ion-card-header>
                <div class="overview-card__header">
                  <div class="overview-card__icon">
                    <ion-icon name="cart-outline"></ion-icon>
                  </div>
                  <ion-card-title>{{ 'dashboard.overview.cards.shopping.title' | translate }}</ion-card-title>
                </div>
              </ion-card-header>
              <ion-card-content>
                <ion-skeleton-text animated style="width: 70%; height: 14px; margin-bottom: 8px;"></ion-skeleton-text>
                <ion-skeleton-text animated style="width: 40%; height: 12px;"></ion-skeleton-text>
              </ion-card-content>
            </ion-card>
          } @else if (facade.lowStockItems().length) {
            <ion-card
              class="overview-card overview-card--stock"
              role="button"
              tabindex="0"
              (click)="onSummaryCardClick('low-or-empty')"
              (keydown.enter)="onSummaryCardClick('low-or-empty')"
              (keydown.space)="onSummaryCardClick('low-or-empty'); $event.preventDefault()"
              [attr.aria-label]="'dashboard.overview.cards.lowOrEmpty.title' | translate"
            >
              <ion-card-header>
                <div class="overview-card__header">
                  <div class="overview-card__icon">
                    <ion-icon name="trending-down-outline"></ion-icon>
                  </div>
                  <ion-card-title>{{ 'dashboard.overview.cards.lowOrEmpty.title' | translate }}</ion-card-title>
                </div>
              </ion-card-header>
              <ion-card-content>
                <p class="overview-card__body">
                  {{ 'dashboard.overview.cards.lowOrEmpty.body' | translate:{ count: facade.lowStockItems().length } }}
                </p>
                <ion-button
                  size="small"
                  fill="clear"
                  (click)="onSummaryCardClick('low-or-empty'); $event.stopPropagation()">
                  {{ 'dashboard.overview.cards.lowOrEmpty.action' | translate }}
                </ion-button>
              </ion-card-content>
            </ion-card>
          }

          @if (!facade.isInventoryLoading() && facade.shoppingListCount()) {
            <ion-card
              class="overview-card overview-card--shopping"
              role="button"
              tabindex="0"
              (click)="onSummaryCardClick('shopping')"
              (keydown.enter)="onSummaryCardClick('shopping')"
              (keydown.space)="onSummaryCardClick('shopping'); $event.preventDefault()"
              [attr.aria-label]="'dashboard.overview.cards.shopping.title' | translate"
            >
              <ion-card-header>
                <div class="overview-card__header">
                  <div class="overview-card__icon">
                    <ion-icon name="cart-outline"></ion-icon>
                  </div>
                  <ion-card-title>{{ 'dashboard.overview.cards.shopping.title' | translate }}</ion-card-title>
                </div>
              </ion-card-header>
              <ion-card-content>
                <p class="overview-card__body">
                  {{ 'dashboard.overview.cards.shopping.body' | translate:{ count: facade.shoppingListCount() } }}
                </p>
                <ion-button
                  size="small"
                  fill="clear"
                  (click)="onSummaryCardClick('shopping'); $event.stopPropagation()">
                  {{ 'dashboard.overview.cards.shopping.action' | translate }}
                </ion-button>
              </ion-card-content>
            </ion-card>
          }
        </div>
      </section>
    }

    @if (facade.recentlyAddedCount() > 0) {
      <section class="overview-section">
        <header class="overview-section-header">
          <h2 class="overview-section-title">{{ 'dashboard.overview.sections.activity.title' | translate }}</h2>
        </header>
        <div class="overview-grid" [attr.aria-label]="'dashboard.overview.sections.activity.title' | translate">
          <ion-card
            class="overview-card overview-card--recent"
            role="button"
            tabindex="0"
            (click)="onSummaryCardClick('recently-added')"
            (keydown.enter)="onSummaryCardClick('recently-added')"
            (keydown.space)="onSummaryCardClick('recently-added'); $event.preventDefault()"
            [attr.aria-label]="'dashboard.overview.cards.recentlyAdded.title' | translate"
          >
            <ion-card-header>
              <div class="overview-card__header">
                <div class="overview-card__icon">
                  <ion-icon name="sparkles-outline"></ion-icon>
                </div>
                <ion-card-title>{{ 'dashboard.overview.cards.recentlyAdded.title' | translate }}</ion-card-title>
              </div>
            </ion-card-header>
            <ion-card-content>
              <p class="overview-card__body">
                {{ 'dashboard.overview.cards.recentlyAdded.body' | translate:{ count: facade.recentlyAddedCount() } }}
              </p>
              <ion-button
                size="small"
                fill="clear"
                (click)="onSummaryCardClick('recently-added'); $event.stopPropagation()">
                {{ 'dashboard.overview.cards.recentlyAdded.action' | translate }}
              </ion-button>
            </ion-card-content>
          </ion-card>
        </div>
      </section>
    }
  </div>

  <app-entity-selector-modal
    [isOpen]="facade.isConsumeTodayOpen()"
    [title]="'dashboard.consumeToday.title' | translate"
    [cardTitle]="'dashboard.consumeToday.cardTitle' | translate"
    [subtitle]="'dashboard.consumeToday.selectHint' | translate"
    [placeholder]="'dashboard.consumeToday.placeholder' | translate"
    [emptyLabel]="'dashboard.consumeToday.noResults' | translate"
    [entriesEmptyLabel]="'dashboard.consumeToday.empty' | translate"
    [saveLabel]="'dashboard.consumeToday.save' | translate"
    [saving]="facade.consumeSaving()"
    [disableSave]="!facade.canSaveConsumeToday()"
    [items]="facade.consumeTodayOptions()"
    [entries]="facade.consumeEntryViewModels()"
    [showSecondaryInfo]="true"
    [showMeta]="true"
    [showAllOnFocus]="true"
    [autofocus]="true"
    (willDismiss)="facade.dismissConsumeTodayModal()"
    (didDismiss)="facade.closeConsumeTodayModal()"
    (selectItem)="facade.addConsumeEntry($event)"
    (adjustEntry)="facade.adjustConsumeEntryById($event.entry.id, $event.delta)"
    (save)="facade.saveConsumeToday()">
  </app-entity-selector-modal>
</ion-content>
