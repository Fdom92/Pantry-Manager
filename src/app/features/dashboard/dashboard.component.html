<ion-header>
  <ion-toolbar>
    <ion-title>{{ 'dashboard.title' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="dashboard" [attr.aria-label]="'dashboard.aria' | translate">
    @if (facade.isInitialInventoryLoading()) {
      <!-- Loading skeleton -->
      <section class="dashboard-section">
        <div class="pantry-health pantry-health--skeleton">
          <div class="pantry-health__icon">
            <ion-skeleton-text animated style="width: 32px; height: 32px; border-radius: 50%;"></ion-skeleton-text>
          </div>
          <div class="pantry-health__content">
            <ion-skeleton-text animated style="width: 160px; height: 20px; margin-bottom: 8px;"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 220px; height: 14px;"></ion-skeleton-text>
          </div>
        </div>
      </section>
    } @else {
      <!-- LAYER 1: Health Status (Interpreted State) -->
      <section class="dashboard-section">
        <div class="pantry-health" [attr.data-state]="facade.pantryHealth().state">
          <div class="pantry-health__icon">
            <ion-icon [name]="facade.getHealthIcon(facade.pantryHealth().state)"></ion-icon>
          </div>
          <div class="pantry-health__content">
            <h2 class="pantry-health__title">{{ facade.pantryHealth().title }}</h2>
            <p class="pantry-health__description">{{ facade.pantryHealth().description }}</p>
          </div>
        </div>
      </section>

      <!-- LAYER 2: What to Do Now (Actions) -->
      @if (facade.actions().length > 0) {
        <section class="dashboard-section">
          <header class="dashboard-section-header">
            <h3 class="dashboard-section-title">{{ 'dashboard.sections.actions.title' | translate }}</h3>
          </header>
          <div class="actions-stack">
            @for (action of facade.actions(); track action.id) {
              <div class="action-card" [attr.data-priority]="action.priority" [attr.data-category]="action.category">
                <div class="action-card__content">
                  <h4 class="action-card__title">{{ action.title }}</h4>
                  <p class="action-card__description">{{ action.description }}</p>
                </div>
                <div class="action-card__footer">
                  <ion-button
                    class="action-card__cta"
                    size="small"
                    [color]="action.category === 'critical' ? 'danger' : action.category === 'preventive' ? 'warning' : 'primary'"
                    (click)="action.cta.action()">
                    {{ action.cta.label }}
                  </ion-button>
                  @if (action.dismissible) {
                    <button class="action-card__dismiss" (click)="facade.dismissAction(action)" aria-label="Dismiss">
                      <ion-icon name="close-outline"></ion-icon>
                    </button>
                  }
                </div>
              </div>
            }
          </div>
        </section>
      }

      <!-- LAYER 3: Additional Context (Optional) -->
      @if (facade.showAdditionalContext() && facade.recentlyAddedCount() > 0 && facade.recentlyAddedCount() <= 5) {
        <section class="dashboard-section">
          <div class="context-section">
            <div class="context-item">
              <ion-icon name="add-circle-outline"></ion-icon>
              <span>{{ 'dashboard.context.recentlyAdded' | translate:{ count: facade.recentlyAddedCount() } }}</span>
            </div>
          </div>
        </section>
      }
    }
  </div>
</ion-content>
