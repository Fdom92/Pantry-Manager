<ion-header>
  <ion-toolbar>
    <ion-title>Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <div class="snapshot-header">
        <ion-card-title>Pantry Snapshot</ion-card-title>
        <ion-button
          fill="clear"
          size="small"
          (click)="toggleSnapshot()"
          [attr.aria-expanded]="showSnapshot()"
          aria-label="Toggle pantry snapshot"
        >
          <ion-icon
            slot="icon-only"
            [name]="showSnapshot() ? 'chevron-up-outline' : 'chevron-down-outline'"
          ></ion-icon>
        </ion-button>
      </div>
      @if (lastUpdated()) {
        <ion-card-subtitle>Updated {{ lastUpdated() | date:'short' }}</ion-card-subtitle>
      }
    </ion-card-header>
    @if (showSnapshot()) {
      <ion-card-content>
        <div class="stat-grid">
          <div class="stat">
            <h3>{{ totalItems() }}</h3>
            <p>Total items</p>
          </div>
          <div class="stat">
            <h3>{{ alertCount() }}</h3>
            <p>Active alerts</p>
          </div>
          <div class="stat">
            <h3>{{ lowStockItems().length }}</h3>
            <p>Low stock</p>
          </div>
          <div class="stat">
            <h3>{{ nearExpiryItems().length }}</h3>
            <p>Expiring soon</p>
          </div>
          <div class="stat">
            <h3>{{ expiredItems().length }}</h3>
            <p>Expired</p>
          </div>
          <div class="stat">
            <h3>{{ categoryCount() }}</h3>
            <p>Categories tracked</p>
          </div>
          <div class="stat">
            <h3>{{ locationCount() }}</h3>
            <p>Locations used</p>
          </div>
        </div>
      </ion-card-content>
    }
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Expiring soon</ion-card-title>
      <ion-card-subtitle>Next {{ nearExpiryWindow }} days</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      @if (nearExpiryItems().length) {
        <ion-list lines="none">
          @for (item of nearExpiryItems(); track item._id) {
            <ion-item lines="none">
              <ion-label>
                <h3>{{ item.name }}</h3>
                <p>Expires {{ item.expirationDate | date:'MMM d, yyyy' }}</p>
              </ion-label>
              <ion-badge color="warning">{{ item.expirationDate | date:'MMM d' }}</ion-badge>
            </ion-item>
          }
        </ion-list>
      } @else {
        <ion-text color="medium">No items close to expiring.</ion-text>
      }
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Low stock alerts</ion-card-title>
      <ion-card-subtitle>At or below minimum level</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      @if (lowStockItems().length) {
        <ion-list lines="none">
          @for (item of lowStockItems(); track item._id) {
            <ion-item lines="none">
              <ion-label>
                <h3>{{ item.name }}</h3>
                <p>
                  {{ item.stock?.quantity }} {{ item.stock?.unit }}
                  (min {{ item.stock?.minThreshold }})
                </p>
              </ion-label>
              <ion-badge color="danger">{{ item.stock?.quantity }}</ion-badge>
            </ion-item>
          }
        </ion-list>
      } @else {
        <ion-text color="medium">All items are above their minimum level.</ion-text>
      }
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Expired items</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      @if (expiredItems().length) {
        <ion-list lines="none">
          @for (item of expiredItems(); track item._id) {
            <ion-item lines="none">
              <ion-label>
                <h3>{{ item.name }}</h3>
                <p>Expired {{ item.expirationDate | date:'MMM d, yyyy' }}</p>
              </ion-label>
              <ion-badge color="medium">Expired</ion-badge>
            </ion-item>
          }
        </ion-list>
      } @else {
        <ion-text color="medium">No expired items right now.</ion-text>
      }
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Recently updated</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      @if (recentItems().length) {
        <ion-list lines="none">
          @for (item of recentItems(); track item._id) {
            <ion-item lines="none">
              <ion-label>
                <h3>{{ item.name }}</h3>
                <p>Updated {{ item.updatedAt | date:'MMM d, yyyy' }}</p>
              </ion-label>
              <ion-badge color="tertiary">New</ion-badge>
            </ion-item>
          }
        </ion-list>
      } @else {
        <ion-text color="medium">No recent updates.</ion-text>
      }
    </ion-card-content>
  </ion-card>
</ion-content>
